<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Malla Interactiva – Historia del Arte</title>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --bg-color:#fffafc; --card-color:#ffffff; --text-color:#2b2b2b; --border-color:#d6d6d6; --hover:#fceef0; --accent-color:#fbb1bd; }
    [data-theme="dark"] { --bg-color:#1c1c1e; --card-color:#2b2b2d; --text-color:#f3f3f3; --border-color:#444; --hover:#333336; --accent-color:#f88a99; }
    * { box-sizing: border-box; }
    body { margin: 0; padding: 20px; font-family: 'Quicksand', sans-serif; background: var(--bg-color); color: var(--text-color); }
    h1 { text-align: center; font-weight: 700; margin: 0 0 4px; font-size: 2rem; color: var(--accent-color); }
    h2#nombre-itinerario { text-align: center; font-weight: 500; margin: 0 0 20px; color: var(--text-color); }
    .botonera { display: flex; flex-wrap: wrap; justify-content: center; gap: 12px; margin-bottom: 20px; }
    select, button { font: inherit; padding: 10px 14px; border: 2px solid var(--border-color); border-radius: 12px; background: var(--card-color); color: var(--text-color); cursor: pointer; }
    button { background: var(--accent-color); color: #fff; font-weight: 600; }
    button:hover { opacity: 0.9; }
    .grid-cursos { display: grid; grid-template-columns: repeat(4, 1fr); gap: 18px; }
    .curso { border-radius: 15px; padding: 15px; background: var(--card-color); box-shadow: 0 2px 6px rgba(0,0,0,.06); max-height: 78vh; overflow-y: auto; }
    .titulo-curso { font-size: 1.2rem; font-weight: 600; margin-bottom: 10px; color: var(--accent-color); }
    .asignatura, .opt-select { margin: 6px 0; padding: 8px 10px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--card-color); transition: .2s; }
    .asignatura { cursor: pointer; font-weight: 500; }
    .asignatura:hover { background: var(--hover); }
    .asignatura.tachada { text-decoration: line-through; color: #aaa; }
    .opt-select select { width: 100%; border: none; background: transparent; color: inherit; font-weight: 500; }
    .primero { background: #fff0f0; }
    .segundo { background: #f0faff; }
    .tercero { background: #f0fff5; }
    .cuarto { background: #fffce6; }
    .tfg { background: #fde4f0; padding: 10px; border-radius: 10px; text-align: center; font-weight: 600; margin-top: 8px; color: var(--text-color); }
    @media print { .botonera { display: none !important; } }
  </style>
</head>
<body>
  <h1>Malla Grado Historia del Arte</h1>
  <h2 id="nombre-itinerario"></h2>
  <div class="botonera">
    <select id="itinerario">
      <option value="">Sin itinerario</option>
    </select>
    <button onclick="buildMalla()">Actualizar</button>
    <button onclick="resetMalla()">Reiniciar</button>
    <button onclick="toggleTheme()">Tema</button>
    <button onclick="window.print()">Descargar PDF</button>
  </div>
  <div class="grid-cursos" id="cursos"></div>

  <script>
    const baseCursos = {
      primero: ["Arte Griego", "Arte de las Primeras Civilizaciones", "Arte Romano", "Historia Antigua", "Historia Medieval", "Historia del Pensamiento I", "Literatura Medieval", "Literatura del Mundo Antiguo", "Museografía y Museología", "Técnicas Artísticas y Conservación"],
      segundo: ["Arte de la Baja Edad Media", "Arte Bizantino y Arte Islámico", "Arte Tardoantiguo y Altomedieval", "Historia Contemporánea", "Historia Moderna", "Historia del Pensamiento II", "Idioma Clásico o Moderno", "Inicios del Arte Moderno", "Literatura Contemporánea", "Literatura Moderna"],
      tercero: ["Arte del Siglo XVI", "Arte del Siglo XVII y Barroco", "Arte de la Ilustración y del Siglo XIX", "Arte de las Vanguardias", "Arte desde 1945 a la Actualidad", "Fuentes de la Historia del Arte", "Historia del Cine", "Patrimonio Histórico-Artístico", "Teoría y Metodología"],
      cuarto: []
    };

    const cursosDiv = document.getElementById("cursos");
    const itinerarioSel = document.getElementById("itinerario");

    function createAsignatura(text) {
      const div = document.createElement("div");
      div.className = "asignatura";
      div.textContent = text;
      div.onclick = () => { div.classList.toggle("tachada"); saveState(); };
      return div;
    }

    function createSelect(options) {
      const wrap = document.createElement("div");
      wrap.className = "opt-select";
      const sel = document.createElement("select");
      const defaultOpt = document.createElement("option");
      defaultOpt.textContent = "Asignatura Optativa";
      defaultOpt.disabled = true;
      defaultOpt.selected = true;
      sel.appendChild(defaultOpt);
      options.forEach(opt => {
        const o = document.createElement("option");
        o.value = opt;
        o.textContent = opt;
        sel.appendChild(o);
      });
      sel.onchange = saveState;
      wrap.appendChild(sel);
      return wrap;
    }

    function buildMalla() {
      cursosDiv.innerHTML = "";
      document.getElementById("nombre-itinerario").textContent = itinerarioSel.value ? `Itinerario: ${itinerarioSel.value}` : "";

      const data = JSON.parse(JSON.stringify(baseCursos));
      const optativas = ["Historia de la Música I", "Velázquez", "Picasso", "Goya", "Arte Contemporáneo Latinoamericano", "Arte Barroco Español", "Iconografía Clásica"];

      ["primero", "segundo", "tercero", "cuarto"].forEach((curso, index) => {
        const div = document.createElement("div");
        div.className = `curso ${curso}`;
        const h = document.createElement("div");
        h.className = "titulo-curso";
        h.textContent = `${index + 1}º Curso`;
        div.appendChild(h);

        data[curso].forEach(asig => div.appendChild(createAsignatura(asig)));

        if (curso === "tercero") div.appendChild(createSelect(optativas));
        if (curso === "cuarto") {
          for (let i = 0; i < 3; i++) div.appendChild(createSelect(optativas));
          div.appendChild(createAsignatura("Trabajo Fin de Grado (TFG)"));
        }

        cursosDiv.appendChild(div);
      });

      loadState();
    }

    function saveState() {
      const state = [];
      document.querySelectorAll(".asignatura").forEach(el => state.push({ t: el.textContent, x: el.classList.contains("tachada") }));
      document.querySelectorAll(".opt-select select").forEach(sel => state.push({ s: sel.value }));
      localStorage.setItem("mallaArte", JSON.stringify(state));
    }

    function loadState() {
      const state = JSON.parse(localStorage.getItem("mallaArte") || "[]");
      let idx = 0;
      document.querySelectorAll(".asignatura").forEach(el => { if (state[idx]?.x) el.classList.add("tachada"); idx++; });
      document.querySelectorAll(".opt-select select").forEach(sel => { const match = state.find(o => o.s === sel.value); if (match) sel.value = match.s; });
    }

    function resetMalla() {
      localStorage.removeItem("mallaArte");
      buildMalla();
    }

    function toggleTheme() {
      const html = document.documentElement;
      html.setAttribute("data-theme", html.getAttribute("data-theme") === "dark" ? "light" : "dark");
    }

    window.onload = buildMalla;
  </script>
</body>
</html>
