<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Malla Interactiva – Historia del Arte</title>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --bg:#fffafc;--card:#fff;--txt:#2b2b2b;--border:#d6d6d6;--hover:#fceef0;--accent:#fbb1bd }
    [data-theme="dark"] { --bg:#1c1c1e;--card:#2b2b2d;--txt:#f3f3f3;--border:#444;--hover:#333336;--accent:#f88a99 }
    * { box-sizing:border-box; margin:0; padding:0 }
    body { font-family:'Quicksand',sans-serif; background:var(--bg); color:var(--txt); padding:20px; height:100vh; overflow:hidden }
    h1 { color:var(--accent); text-align:center; font-size:2rem; margin-bottom:4px }
    #nombre-itinerario { text-align:center; margin-bottom:14px; font-weight:500 }
    .botonera { display:flex; flex-wrap:wrap; justify-content:center; gap:10px; margin-bottom:14px }
    select,button { padding:8px 12px; border:2px solid var(--border); border-radius:10px; background:var(--card); color:var(--txt); font:inherit; cursor:pointer }
    button { background:var(--accent); color:#fff; font-weight:600 }
    button:hover { opacity:.9 }
    .grid { display:flex; gap:10px; height:calc(100vh - 200px); overflow-x:auto }
    .curso { background:var(--card); border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,.06); padding:12px; min-width:250px; width:24% }
    .titulo { font-weight:600; color:var(--accent); margin-bottom:6px }
    .item,.opt { margin:4px 0; padding:6px 8px; border:1px solid var(--border); border-radius:6px; background:var(--card) }
    .item { cursor:pointer } .item:hover { background:var(--hover) } .tach { text-decoration:line-through; color:#aaa }
    .opt select { width:100%; border:none; background:transparent }
    .tfg { background:#fde4f0; padding:6px; border-radius:6px; text-align:center; font-weight:600; margin-top:4px }
    @media(max-width:768px) { body{overflow:auto} .grid{flex-direction:column;height:auto;overflow-x:hidden} .curso{width:100%} }
    @media print { .botonera{display:none} .grid{overflow:visible;height:auto} body{overflow:visible;height:auto} }
  </style>
</head>
<body>
  <h1>Malla Grado Historia del Arte</h1>
  <h2 id="nombre-itinerario"></h2>
  <div class="botonera">
    <select id="itin"></select>
    <button onclick="build()">Actualizar</button>
    <button onclick="reset()">Reiniciar</button>
    <button onclick="toggleTheme()">Tema</button>
    <button onclick="window.print()">PDF</button>
  </div>
  <div class="grid" id="grid"></div>
<script>
const baseCursos = {
  primero: [
    "Arte Griego","Arte de las Primeras Civilizaciones","Arte Romano","Historia Antigua","Historia del Pensamiento y de las Ideas",
    "Estéticas I","Historia Medieval","Literatura Medieval","Literatura del Mundo Antiguo","Museografía y Museología"
  ],
  segundo: [
    "Arte Bizantino y Arte Islámico","Arte Tardoantiguo y Altomedieval","Historia Moderna","Idioma","Literatura Moderna",
    "Arte de la Baja Edad Media","Historia del Pensamiento y de las Ideas Estéticas II","Historia Contemporánea","Inicios del Arte Moderno","Literatura Contemporánea"
  ],
  tercero: [
    "Arte de la Ilustración y del Siglo XIX","Arte del Siglo XVI","Arte del Siglo XVII y Barroco Tardío","Fuentes de la Historia del Arte",
    "Teoría y Metodología de la Historia del Arte","Arte de las Vanguardias","Arte desde 1945 a la actualidad","Historia del Cine",
    "Patrimonio Histórico-Artístico y Gestión Cultural","Asignatura optativa"
  ],
  cuarto: []
};

const optativasGeneral = [
  "Al-Ándalus: Ciudades, Mezquitas y Palacios","Arquitectura y Ciudad en la Edad Moderna","Arquitectura y Modernidad",
  "Arte Antiguo de la Península Ibérica","Arte Barroco Español","Arte, Catedral y Ciudad en la Edad Media Hispana",
  "Arte Contemporáneo Latinoamericano","Arte Español del Renacimiento","Arte Español Siglo XX",
  "Arte Hispanoamericano en la Edad Moderna","Arte de la India y Asia Oriental","Arte Indígena Americano",
  "Arte, Peregrinación y Monacato en la Edad Media Hispana","Arte y Sociedad en la Edad Moderna","Artes Suntuarias y del Libro en la Edad Media",
  "Goya","Historia de la Arqueología y del Coleccionismo de Antigüedades","Historia de la Música I","Historia de la Música II",
  "Iconografía Clásica","Iconografía Medieval","La Ciudad en la Antigüedad","Paleografía y Diplomática","Picasso",
  "Pintura y Sociedad en la Edad Media","Velázquez","Prácticas Externas"
];

const itinerarios = {
  "Arte Antiguo": {
    fix3: [], opt3: 1,
    fix4: ["La Ciudad en la Antigüedad","Arte Antiguo de la Península Ibérica","Arte de la India y del Asia Oriental",
           "Arte Indígena Americano","Historia de la Arqueología y del Coleccionismo de Antigüedades","Iconografía Clásica"],
    opt4: 3
  },
  "Arte Medieval": {
    fix3: [], opt3: 1,
    fix4: ["Paleografía y Diplomática","Pintura y Sociedad en la Edad Media","Artes Suntuarias y del Libro en la Edad Media",
           "Arte, Peregrinación y Monacato en la Edad Media Hispana","Arte, Catedral y Ciudad en la Edad Media Hispana",
           "Al-Ándalus: Ciudades, Mezquitas y Palacios","Iconografía Medieval","Historia de la Música I"],
    opt4: 1
  },
  "Edad Moderna": {
    fix3: [], opt3: 1,
    fix4: ["Paleografía y Diplomática","Arquitectura y Ciudad en la Edad Moderna","Arte y Sociedad en la Edad Moderna",
           "Arte Español del Renacimiento","Velázquez","Arte Barroco Español","Arte Hispanoamericano en la Edad Moderna",
           "Historia de la Música I"],
    opt4: 1
  },
  "Arte Contemporáneo": {
    fix3: [], opt3: 1,
    fix4: ["Arquitectura y Modernidad","Arte Contemporáneo Latinoamericano","Goya","Picasso",
           "Arte Español Siglo XX","Historia de la Música II"],
    opt4: 3
  },
  "Museos": {
    fix3: ["La Ciudad en la Antigüedad"], opt3: 0,
    fix4: ["Artes Suntuarias y del Libro en la Edad Media","Arte, Catedral y Ciudad en la Edad Media Hispana",
           "Al-Ándalus: Ciudades, Mezquitas y Palacios","Arquitectura y Ciudad en la Edad Moderna","Velázquez",
           "Arquitectura y Modernidad","Goya","Picasso","Historia de la Arqueología y del Coleccionismo de Antigüedades"],
    opt4: 0
  },
  "Arte Español": {
    fix3: [], opt3: 1, fix4: [], opt4: 9,
    special: ["Arte Antiguo de la Península Ibérica","Arte, Peregrinación y Monacato en la Edad Media Hispana",
              "Arte, Catedral y Ciudad en la Edad Media Hispana","Al-Ándalus: Ciudades, Mezquitas y Palacios",
              "Arte Español del Renacimiento","Velázquez","Arte Barroco Español","Arte Hispanoamericano en la Edad Moderna",
              "Arte Contemporáneo Latinoamericano","Goya","Picasso","Arte Español Siglo XX","Prácticas Externas"]
  }
};

const grid = document.getElementById('grid');
const itinSel = document.getElementById('itin');
Object.keys(itinerarios).forEach(n => {
  const o = document.createElement('option');
  o.value = n;
  o.textContent = n;
  itinSel.appendChild(o);
});

function item(t) {
  const d = document.createElement('div');
  d.className = 'item';
  d.textContent = t;
  d.onclick = () => { d.classList.toggle('tach'); save(); };
  return d;
}
function opt(list) {
  const w = document.createElement('div'); w.className = 'opt';
  const s = document.createElement('select');
  const def = document.createElement('option'); def.disabled = true; def.selected = true; def.textContent = 'Asignatura Optativa';
  s.appendChild(def);
  list.forEach(t => {
    const o = document.createElement('option');
    o.value = o.textContent = t;
    s.appendChild(o);
  });
  s.onchange = save; w.appendChild(s); return w;
}

function build() {
  grid.innerHTML = "";
  const itin = itinerarios[itinSel.value];
  document.getElementById("nombre-itinerario").textContent = itinSel.value ? `Itinerario: ${itinSel.value}` : "";
  const list = itin?.special || optativasGeneral;

  // Primero y Segundo
  ['primero','segundo'].forEach(c => addCurso(c, baseCursos[c]));
  
  // Tercero
  const tercero = [...baseCursos.tercero.slice(0,9)];
  const wrap3 = document.createElement('div');
  wrap3.className = 'curso tercero';
  wrap3.innerHTML = `<div class='titulo'>Tercero</div>`;
  tercero.forEach(a => wrap3.appendChild(item(a)));
  (itin?.fix3 || []).forEach(a => wrap3.appendChild(item(a)));
  const o3 = itin?.opt3 ?? 1;
  for (let i = 0; i < o3; i++) wrap3.appendChild(opt(list));
  grid.appendChild(wrap3);

  // Cuarto
  const wrap4 = document.createElement('div');
  wrap4.className = 'curso cuarto';
  wrap4.innerHTML = `<div class='titulo'>Cuarto</div>`;
  (itin?.fix4 || []).forEach(a => wrap4.appendChild(item(a)));
  const o4 = itin?.opt4 ?? 9;
  for (let i = 0; i < o4; i++) wrap4.appendChild(opt(list));
  wrap4.appendChild(item("Trabajo Fin de Grado (TFG)"));
  grid.appendChild(wrap4);

  load();
}

function addCurso(nombre, arr) {
  const d = document.createElement('div');
  d.className = `curso ${nombre}`;
  d.innerHTML = `<div class='titulo'>${nombre.charAt(0).toUpperCase()+nombre.slice(1)}</div>`;
  arr.forEach(a => d.appendChild(item(a)));
  grid.appendChild(d);
}

function save() {
  const state = [];
  document.querySelectorAll('.item').forEach(e => state.push({ t: e.textContent, x: e.classList.contains('tach') }));
  document.querySelectorAll('.opt select').forEach(s => state.push({ s: s.value }));
  localStorage.setItem('mallaHDA', JSON.stringify(state));
}
function load() {
  const st = JSON.parse(localStorage.getItem('mallaHDA') || '[]');
  let i = 0;
  document.querySelectorAll('.item').forEach(e => { if (st[i]?.x) e.classList.add('tach'); i++; });
  document.querySelectorAll('.opt select').forEach(s => { const m = st.find(o => o.s === s.value); if (m) s.value = m.s; });
}
function reset() { localStorage.removeItem('mallaHDA'); build(); }
function toggleTheme() { document.documentElement.toggleAttribute('data-theme','dark'); }

build();
</script>
</body>
</html>
