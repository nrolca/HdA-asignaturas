<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Malla Interactiva – Historia del Arte</title>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --bg-color:#fffafc; --card-color:#ffffff; --text-color:#2b2b2b; --border-color:#d6d6d6; --hover:#fceef0; --accent-color:#fbb1bd; }
    [data-theme="dark"] { --bg-color:#1c1c1e; --card-color:#2b2b2d; --text-color:#f3f3f3; --border-color:#444; --hover:#333336; --accent-color:#f88a99; }
    *{box-sizing:border-box}
    body{margin:0;padding:20px;font-family:'Quicksand',sans-serif;background:var(--bg-color);color:var(--text-color);}
    h1{text-align:center;font-weight:700;margin:0 0 4px;font-size:2rem;color:var(--accent-color)}
    h2#nombre-itinerario{text-align:center;font-weight:500;margin:0 0 20px;color:var(--text-color)}
    .botonera{display:flex;flex-wrap:wrap;justify-content:center;gap:12px;margin-bottom:20px}
    select,button{font:inherit;padding:10px 14px;border:2px solid var(--border-color);border-radius:12px;background:var(--card-color);color:var(--text-color);cursor:pointer}
    button{background:var(--accent-color);color:#fff;font-weight:600}button:hover{opacity:0.9}
    .grid-cursos{display:grid;grid-template-columns:repeat(4,1fr);gap:18px}
    .curso{border-radius:15px;padding:15px;background:var(--card-color);box-shadow:0 2px 6px rgba(0,0,0,.06);max-height:78vh;overflow-y:auto}
    .titulo-curso{font-size:1.2rem;font-weight:600;margin-bottom:10px;color:var(--accent-color)}
    .asignatura,.opt-select{margin:6px 0;padding:8px 10px;border:1px solid var(--border-color);border-radius:8px;background:var(--card-color);transition:.2s}
    .asignatura{cursor:pointer;font-weight:500}.asignatura:hover{background:var(--hover)}.asignatura.tachada{text-decoration:line-through;color:#aaa}
    .opt-select select{width:100%;border:none;background:transparent;color:inherit;font-weight:500}
    .primero{background:#fff0f0}.segundo{background:#f0faff}.tercero{background:#f0fff5}.cuarto{background:#fffce6}
    .tfg{background:#fde4f0;padding:10px;border-radius:10px;text-align:center;font-weight:600;margin-top:8px;color:var(--text-color)}
    @media print{.botonera{display:none!important}}
  </style>
</head>
<body>
  <h1>Malla Grado Historia del Arte</h1>
  <h2 id="nombre-itinerario"></h2>
  <div class="botonera">
    <select id="itinerario"></select>
    <button id="btnActualizar">Actualizar</button>
    <button id="btnReiniciar">Reiniciar</button>
    <button id="btnTema">Tema</button>
    <button id="btnPDF">Descargar PDF</button>
  </div>
  <div class="grid-cursos" id="cursos"></div>
  <script>
const itinerarios = {
  "Arte Antiguo": {
    fixed: [
      "La Ciudad en la Antigüedad",
      "Arte Antiguo de la Península Ibérica",
      "Arte de la India y del Asia Oriental",
      "Arte Indígena Americano",
      "Historia de la Arqueología y del Coleccionismo de Antigüedades",
      "Iconografía Clásica"
    ],
    opt3: true,
    opt4: 3
  },
  "Arte Medieval": {
    fixed: [
      "Paleografía y Diplomática",
      "Pintura y Sociedad en la Edad Media",
      "Artes Suntuarias y del Libro en la Edad Media",
      "Arte, Peregrinación y Monacato en la Edad Media Hispana",
      "Arte, Catedral y Ciudad en la Edad Media Hispana",
      "Al-Ándalus: Ciudades, Mezquitas y Palacios",
      "Iconografía Medieval",
      "Historia de la Música I"
    ],
    opt3: true,
    opt4: 1
  },
  "Edad Moderna": {
    fixed: [
      "Paleografía y Diplomática",
      "Arquitectura y Ciudad en la Edad Moderna",
      "Arte y Sociedad en la Edad Moderna",
      "Arte Español del Renacimiento",
      "Velázquez",
      "Arte Barroco Español",
      "Arte Hispanoamericano en la Edad Moderna",
      "Historia de la Música I"
    ],
    opt3: true,
    opt4: 1
  },
  "Arte Contemporáneo": {
    fixed: [
      "Arquitectura y Modernidad",
      "Arte Contemporáneo Latinoamericano",
      "Goya",
      "Picasso",
      "Arte Español Siglo XX",
      "Historia de la Música II"
    ],
    opt3: true,
    opt4: 3
  },
  "Museos": {
    fixed: [
      "La Ciudad en la Antigüedad",
      "Artes Suntuarias y del Libro en la Edad Media",
      "Arte, Catedral y Ciudad en la Edad Media Hispana",
      "Al-Ándalus: Ciudades, Mezquitas y Palacios",
      "Arquitectura y Ciudad en la Edad Moderna",
      "Velázquez",
      "Arquitectura y Modernidad",
      "Goya",
      "Picasso",
      "Historia de la Arqueología y del Coleccionismo de Antigüedades"
    ],
    opt3: false,
    opt4: 0
  },
  "Arte Español": {
    fixed: [],
    opt3: true,
    opt4: 9,
    special: [
      "Arte Antiguo de la Península Ibérica",
      "Arte, Peregrinación y Monacato en la Edad Media Hispana",
      "Arte, Catedral y Ciudad en la Edad Media Hispana",
      "Al-Ándalus: Ciudades, Mezquitas y Palacios",
      "Arte Español del Renacimiento",
      "Velázquez",
      "Arte Barroco Español",
      "Arte Hispanoamericano en la Edad Moderna",
      "Arte Contemporáneo Latinoamericano",
      "Goya",
      "Picasso",
      "Arte Español Siglo XX",
      "Prácticas Externas"
    ]
  }
};

const optativasGeneral = [
  "Al-Ándalus: Ciudades, Mezquitas y Palacios",
  "Arquitectura y Ciudad en la Edad Moderna",
  "Arquitectura y Modernidad",
  "Arte Antiguo de la Península Ibérica",
  "Arte Barroco Español",
  "Arte, Catedral y Ciudad en la Edad Media Hispana",
  "Arte Contemporáneo Latinoamericano",
  "Arte Español del Renacimiento",
  "Arte Español Siglo XX",
  "Arte Hispanoamericano en la Edad Moderna",
  "Arte de la India y Asia Oriental",
  "Arte Indígena Americano",
  "Arte, Peregrinación y Monacato en la Edad Media Hispana",
  "Arte y Sociedad en la Edad Moderna",
  "Artes Suntuarias y del Libro en la Edad Media",
  "Goya",
  "Historia de la Arqueología y del Coleccionismo de Antigüedades",
  "Historia de la Música I",
  "Historia de la Música II",
  "Iconografía Clásica",
  "Iconografía Medieval",
  "La Ciudad en la Antigüedad",
  "Paleografía y Diplomática",
  "Picasso",
  "Pintura y Sociedad en la Edad Media",
  "Velázquez",
  "Prácticas Externas"
];

// ---------- funciones ----------
function buildMalla() {
  const nombre = document.getElementById("itinerario").value;
  document.getElementById("nombre-itinerario").textContent = nombre ? `Itinerario: ${nombre}` : "";

  const data = JSON.parse(JSON.stringify(baseCursos));
  let opt3 = 1, opt4 = 9, options = optativasGeneral;

  if (nombre && itinerarios[nombre]) {
    const info = itinerarios[nombre];
    const mitad = Math.ceil(info.fixed.length / 2);
    data.tercero.push(...info.fixed.slice(0, mitad));
    data.cuarto.push(...info.fixed.slice(mitad));
    opt3 = info.opt3 ? 1 : 0;
    opt4 = info.opt4 || 0;
    if (info.special) options = info.special;
  }

  cursosDiv.innerHTML = "";
  ["primero", "segundo", "tercero", "cuarto"].forEach((key, i) => {
    const curso = document.createElement("div");
    curso.className = `curso ${key}`;
    curso.innerHTML = `<div class='titulo-curso'>${i + 1}º Curso</div>`;
    data[key].forEach(a => curso.appendChild(createAsignatura(a)));
    if (key === "tercero") for (let j = 0; j < opt3; j++) curso.appendChild(createSelect(options));
    if (key === "cuarto") {
      for (let j = 0; j < opt4; j++) curso.appendChild(createSelect(options));
      curso.appendChild(createAsignatura("Trabajo Fin de Grado (TFG)"));
    }
    cursosDiv.appendChild(curso);
  });

  loadState();
}

function saveState() {
  const state = [];
  document.querySelectorAll(".asignatura").forEach(el => {
    state.push({ t: el.textContent, x: el.classList.contains("tachada") });
  });
  document.querySelectorAll(".opt-select select").forEach(sel => {
    state.push({ s: sel.value });
  });
  localStorage.setItem("mallaArte", JSON.stringify(state));
}

function loadState() {
  const state = JSON.parse(localStorage.getItem("mallaArte") || "[]");
  let idxA = 0;
  document.querySelectorAll(".asignatura").forEach(el => {
    const st = state[idxA++];
    if (st && st.x) el.classList.add("tachada");
  });
  document.querySelectorAll(".opt-select select").forEach(sel => {
    const match = state.find(o => o.s && o.s === sel.value);
    if (match) sel.value = match.s;
  });
}

  </script>
</body>
</html>
